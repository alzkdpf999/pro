package com.example.demo.controller;

import java.util.UUID;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import com.example.demo.entity.UserEntity;
import com.example.demo.kurento.Room;
import com.example.demo.kurento.RoomManager;
import com.example.demo.repository.JpaUserRepository;

import lombok.extern.slf4j.Slf4j;

@Controller
@Slf4j
@Transactional
public class MainController {

	// 방 생성과 그 방 아이디 이름 참가자? 정도 저장하는 디비가 필요할듯
	
	int t=0;

	@Autowired
	private RoomManager roomManager;
	
	@Autowired
	private JpaUserRepository u;
	
	@GetMapping("/")
	public String goChatRoom() {
		log.info("접속이 되나요??");
		UserEntity kk = UserEntity.builder().email("rasdeal@ac.kr").name("test").passwd("test").build();
		u.save(kk);
		return "test/hello";
	}

	@GetMapping("/asd")
	public String test() {
		return "test/roomlist";
	}

	@GetMapping("/chat/room")
	public String roomDetail(Model model, String roomId) {
		log.info("roomId {}", roomId);
		// principalDetails 가 null 이 아니라면 로그인 된 상태!!
		Room room = roomManager.getRoom(roomId);
		model.addAttribute("room", room);
		// 임시로 사용자명, 방 아이디, 이름 설정
		String uuid = String.valueOf(t);//UUID.randomUUID().toString().split("-")[0];
		t++;
		model.addAttribute("uuid", uuid);
		model.addAttribute("roomId", "test");
		model.addAttribute("roomName", "test");

		return "test/kurentoroom";
	}
	
}